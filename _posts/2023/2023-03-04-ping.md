---
layout: post
title: "网络知识-ping程序"
date: 2023-03-03 10:10:00 +0800
categories: tech
---
ping程序是我们在网络调试中常用的一个程序命令，它用来判断另一台主机是否可达。这里讲解一下ping程序的一些细节。

## 过程

ping程序监测主机可达性的过程就好像声呐定位，它会发送一份ICMP协议的回显请求报文，然后等待ICMP回显应答报文返回。ICMP回显请求和应答报文格式如下，其中类型为8是回显请求报文，类型为0是回显应答报文。序列号从1开始，每发送一次新的回显请求就加一。
![img](https://raw.githubusercontent.com/xiejinjie/xiejinjie.github.io/gh-pages/assets/img/20230304150032.png)



ping程序当收到回显应答时，就会打印出序列号、TTL和往返时间。TTL位于IP首部的生存字段里；往返时间的计算是在ICMP报文中存放请求发送的时间，然后当应答返回时，用当前时间减去报文中的发送时间。一次ping过程和对应抓包内容如下，其中08是类型，0001是序号，40f40264000000存放的是发送报文的时间戳。

![img](https://raw.githubusercontent.com/xiejinjie/xiejinjie.github.io/gh-pages/assets/img/20230304151543.png)

![img](https://raw.githubusercontent.com/xiejinjie/xiejinjie.github.io/gh-pages/assets/img/20230304154728.png)



值得注意的是，由于网络安全的加强，一台主机可能受路由的访问控制和防火墙的限制，主机的可达性不止取决于IP层，还取决于使用何种协议以及端口。可能出现ping程序显示主机不可达，但是可以使用telnet远程登陆主机的25端口。

## 参考资料

《TCP IP协议详解 · 卷一》第七章 ping程序
